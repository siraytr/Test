<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Datei Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-3xl mx-auto bg-white rounded shadow p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Datei Upload</h2>
      <a href="/logout" class="text-red-500">Logout</a>
    </div>

    <form action="/upload" method="post" enctype="multipart/form-data" class="mb-6">
      <input type="file" name="file" required class="mb-2" />
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Hochladen</button>
    </form>

    <div id="file-list">
      <h3 class="text-lg font-semibold mb-2">Hochgeladene Dateien</h3>
      <ul class="list-disc list-inside" id="files"></ul>
    </div>

    <div id="admin-section" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-2">Speicherort auswählen</h3>
      <form action="/admin/setdisk" method="post">
        <select name="disk" id="diskSelect" class="border p-2 rounded mb-2"></select>
        <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Speichern</button>
      </form>
    </div>
  </div>

  <script>
    // Dateien abrufen und anzeigen
    fetch('/files')
      .then(res => res.json())
      .then(files => {
        const list = document.getElementById('files');
        files.forEach(f => {
          const li = document.createElement('li');
          li.textContent = f;
          list.appendChild(li);
        });
      });

    // Adminbereich aktivieren, wenn verfügbar
    fetch('/admin/disks')
      .then(res => {
        if (res.status === 403) return;
        document.getElementById('admin-section').classList.remove('hidden');
        return res.json();
      })
      .then(disks => {
        const select = document.getElementById('diskSelect');
        if (!disks) return;
        disks.forEach(d => {
          const option = document.createElement('option');
          option.value = d;
          option.textContent = d;
          select.appendChild(option);
        });
      });
  </script>
</body>
</html>
